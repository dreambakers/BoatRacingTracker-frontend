<div class="container-fluid h-100">
  <div class="d-flex h-100">
    <div class="flex-fill overflow-auto h-100 p-2">
      <mat-card class="min-h-100 p-0">
        <h3 class="font-weight-bold p-3 border-bottom">Races</h3>
        <mat-list>
          <ng-container *ngFor="let race of races; let i = index">
            <mat-list-item [class.selected]="selectedRace._id === race._id" class="pointer d-flex"
              (click)="selectRace(race)">
              <div class="flex-grow-1 text-overflow">
                {{ race.name }}
              </div>
              <app-race-status [race]="race"></app-race-status>
            </mat-list-item>
            <div class="d-md-none p-2 mobile-expanded-panel selected" *ngIf="selectedRace._id === race._id">
              <ng-container *ngTemplateOutlet="raceDetails"></ng-container>
            </div>
            <mat-divider></mat-divider>
          </ng-container>
        </mat-list>
      </mat-card>
    </div>

    <div class="d-none d-md-block w-75">
      <ng-container *ngTemplateOutlet="raceDetails"></ng-container>
    </div>
  </div>
</div>

<ng-template #raceDetails>
  <div class="d-flex flex-column flex-md-row h-100">
    <div class="flex-fill p-2">
      <mat-card style="min-height: 100%; height: 500px">
        <app-map [race]="selectedRace"></app-map>
      </mat-card>
    </div>

    <div class="w-25 contestants overflow-auto h-100 p-2">
      <mat-card class="min-h-100 p-0">
        <h3 class="font-weight-bold p-3 border-bottom">Contestants</h3>
        <mat-list>
          <ng-container *ngFor="let contestant of selectedRace?.contestants">
            <mat-list-item>
              {{ contestant.name }}
              {{ calculateDistance(contestant) }} km
            </mat-list-item>
            <mat-divider></mat-divider>
          </ng-container>
        </mat-list>
      </mat-card>
    </div>
  </div>
</ng-template>